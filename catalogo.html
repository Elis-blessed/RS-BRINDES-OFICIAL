<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Catálogo - RS Brindes</title>
  <link rel="stylesheet" href="public/style.css">
</head>
<body>

<header class="header gradient">
  <nav class="nav container">
    <div class="brand"><div class="logo">RS</div><span>RS BRINDES</span></div>
    <div class="menu">
      <a href="index.html">Home</a>
      <a href="sobre.html">Sobre Nós</a>
      <a href="catalogo.html" class="active">Catálogo</a>
      <a href="orcamento.html">Orçamento</a>
      <a href="contato.html">Contato</a>
      <a href="blog.html">Blog</a>
    </div>
  </nav>
</header>

<section class="section container">
  <h1>Catálogo de Produtos</h1>
  <div class="toolbar">
    <input type="text" id="search" class="search" placeholder="Pesquisar produto...">
    <select id="category"></select>
  </div>
  <div class="grid products" id="grid"></div>
</section>

<footer class="footer">
  <div class="container foot">
    <span>© <span id="year"></span> RS Brindes</span>
  </div>
</footer>

<script>
const state = { products: [], filtered: [], q: '', cat: 'Todas' };

const $grid = document.getElementById('grid');
const $search = document.getElementById('search');
const $category = document.getElementById('category');

fetch('data/products.json')
  .then(r => r.json())
  .then(items => {
    state.products = items;
    buildCategories(items);
    applyFilters();
  });

function buildCategories(items){
  const cats = Array.from(new Set(items.map(i => i.category))).sort();
  $category.innerHTML = '';
  const optAll = document.createElement('option');
  optAll.value = 'Todas'; optAll.textContent = 'Todas';
  $category.appendChild(optAll);
  cats.forEach(c => {
    const o = document.createElement('option');
    o.value = c; o.textContent = c;
    $category.appendChild(o);
  });
  $category.addEventListener('change', () => { state.cat = $category.value; applyFilters(); });
}

$search.addEventListener('input', () => { state.q = $search.value.toLowerCase(); applyFilters(); });
  // Se vier ?cat= no link, já seleciona a categoria ao carregar
const params = new URLSearchParams(location.search);
const pre = params.get('cat');
if (pre) {
  // espera o select existir e, se houver a opção, seleciona
  const trySelect = () => {
    const opt = Array.from($category.options).find(o => o.value === pre);
    if (opt) {
      $category.value = pre;
      state.cat = pre;
      applyFilters();
    }
  };
  trySelect();
}

function applyFilters(){
  const { products, q, cat } = state;
  state.filtered = products.filter(p => 
    (cat === 'Todas' || p.category === cat) &&
    (q === '' || p.name.toLowerCase().includes(q))
  );
  render();
}

function render(){
  if (state.filtered.length === 0){
    $grid.innerHTML = '<div class="card card-pad" style="grid-column:1/-1;text-align:center">Nenhum item encontrado</div>';
    return;
  }
  $grid.innerHTML = state.filtered.map(p => `
    <div class="card">
      <img class="product" src="${p.image}" alt="${p.name}" onerror="this.style.display='none'"/>
      <div class="card-pad">
        <div class="title">${p.name}</div>
        <div class="cat">${p.category}</div>
        <div style="margin-top:8px">
          <a class="btn btn-primary" href="orcamento.html">Solicitar Orçamento</a>
        </div>
      </div>
    </div>
  `).join('');
}
</script>

</body>
</html>
